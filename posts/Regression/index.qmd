---
title: "Employee Churn- Survival Analysis"
author: "Karol Orozco"
date: "2022-10-04"
---

## 1. Introduction



## 2. Import Libraries

```{r, echo=FALSE}
library(tidyverse)
library(ggplot2)
library(survival)
library(skimr)
library(gridExtra)
library(colorspace) 

```

## 3. Load and Prepare the Data

This data set came from Kaggle

```{r}
employee.att <- read.csv("C:/Users/karol/Desktop/Portfolio/DATASET/IBM-HR-Employee-Attrition.csv")
```

Let's take a look at the data:

```{r}
str(employee.att)
```

This data set contains 1470 observations and 35 variables. However, for this analysis, I am interested in the following fields:

```{r}
empl.att <- employee.att %>%
  dplyr:::select.data.frame("Attrition", "Department", "Age", "Gender", "MaritalStatus", "DistanceFromHome", "JobSatisfaction", "JobLevel", "YearsAtCompany", "YearsSinceLastPromotion", "OverTime", "MonthlyIncome")

names(empl.att)
```

```{r}
skim(empl.att)
```

There are not missing values and most of the variables are positively skewed.
The age range varies from 18 to 60 years old.
Total Working Years ranging from 0 to 40 years.
Monthly Income ranging from 1009 to 19999.


#### Convert Variables


```{r}

empl.att <- empl.att %>%
mutate_if(is.character, factor) %>% 
mutate(JobLevel = factor(JobLevel),
       JobSatisfaction = factor(JobSatisfaction),
       AgeGroup = case_when(Age > 17 & Age <= 19 ~ "17-19",
                            Age > 19 & Age <= 30 ~ "20-30",
                            Age > 30 & Age <= 40 ~ "30-40",
                            Age > 40 & Age <= 50 ~ "40-50",
                            Age > 50 & Age <= 60 ~ "50-60", 
                            Age > 60             ~ "> 60")) %>% 
mutate(AgeGroup = factor(AgeGroup, level = c("17-19","20-30", "30-40","40-50","50-60","> 60")))%>% 
mutate(Attrition = factor(Attrition, levels = c("Yes", "No")))

str(empl.att)
```


## 4. Exploratory Data Analysis

#### Let's see the number of deserters

```{r}
table(empl.att$Attrition)
```

#### Let's take a look at the attrition vs some variables

```{r, warning=FALSE, fig.width = 20, fig.height = 12}

## MaritalStatus vs Attrition

ms_att <- ggplot(empl.att) +
 aes(x = MaritalStatus, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Marital Status", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, face = "bold.italic", hjust = 0.5))


## Age Group vs Attrition

ag_att <- ggplot(empl.att) +
 aes(x = AgeGroup, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs( title = "By Age Group", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))


## Gender vs Attrition

ge_att <- ggplot(empl.att) +
 aes(x = Gender, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Gender", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))


## DistanceFromHome vs Attrition

dh_att <- ggplot(empl.att) +
 aes(x = DistanceFromHome, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs( x= "Miles",
  title = "By Distance From Home", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))


## Department vs Attrition

dep_att <- ggplot(empl.att) +
 aes(x = Department, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Department", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))


## YearsAtCompany vs Attrition

yac_att <- ggplot(empl.att) +
 aes(x = YearsAtCompany, fill = Attrition) +
 geom_density(adjust = 1L) +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Years at the Company", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))


## JobLevel vs Attrition

jl_att <- ggplot(empl.att) +
 aes(x = JobLevel, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Job Level", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))

## Montly Income

mi_att<- ggplot(empl.att) +
 aes(x = MonthlyIncome, fill = Attrition) +
 geom_density(adjust = 1L) +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Montly Income", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, face = "bold.italic", hjust = 0.5))

## YearsSinceLast Promotion vs Attrition


  yslp_att <- ggplot(empl.att) +
 aes(x = YearsSinceLastPromotion, fill = Attrition) +
 geom_density(adjust = 1L) +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Years Since Last Promotion", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))



#JobSatisfaction vs Attrition

jbs_att <- ggplot(empl.att) +
 aes(x = JobSatisfaction, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By Age Group", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))


## OverTime vs Attrition

  
  ot_att <- ggplot(empl.att) +
 aes(x = OverTime, fill = Attrition) +
 geom_bar() +
 scale_fill_brewer(palette = "Dark2", 
 direction = 1) +
 labs(title = "By OverTime", y= " ") +
 theme_minimal() +
 theme(plot.title = element_text(size = 12L, 
 face = "bold.italic", hjust = 0.5))


grid.arrange(ot_att, jbs_att, yslp_att, mi_att, jl_att, dep_att, yac_att, ms_att, ag_att, ge_att, dh_att, ncol = 3, nrow = 4)

```


## 5. Survival Model


## 6. Conclusion and Recomendations


