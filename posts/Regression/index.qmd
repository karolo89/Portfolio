---
title: "Employee Churn- Survival Analysis"
author: "Karol Orozco"
date: "2022-10-04"
---

## 1. Introduction



## 2. Import Libraries

```{r, echo=FALSE}
library(tidyverse)
library(ggplot2)
library(survival)
library(skimr)
library(GGally)

```

## 3. Load and Prepare the Data

This data set came from Kaggle

```{r}
employee.att <- read.csv("C:/Users/karol/Desktop/Portfolio/DATASET/IBM-HR-Employee-Attrition.csv")
```

Let's take a look at the data:

```{r}
str(employee.att)
```

This data set contains 1470 observations and 35 variables. However, for this analysis, I am interested in the following fields:

```{r}
empl.att <- employee.att %>%
  dplyr:::select.data.frame("Attrition", "Department", "Age", "Gender", "MaritalStatus", "DistanceFromHome", "JobSatisfaction", "JobLevel", "YearsAtCompany", "YearsSinceLastPromotion", "OverTime", "MonthlyIncome")

names(empl.att)
```

```{r}
skim(empl.att)
```

There are not missing values and most of the variables are positively skewed.
The age range varies from 18 to 60 years old.
Total Working Years ranging from 0 to 40 years.
Monthly Income ranging from 1009 to 19999.


#### Convert Variables

 [1] "Attrition"               "Department"              "Age"                     "Gender"                 
 [5] "MaritalStatus"           "DistanceFromHome"        "JobSatisfaction"         "JobLevel"               
 [9] "YearsAtCompany"          "YearsSinceLastPromotion" "OverTime"                "MonthlyIncome"  
 
 
```{r}

empl.att <- empl.att %>%
mutate_if(is.character, factor) %>% 
mutate(JobLevel = factor(JobLevel),
       JobSatisfaction = factor(JobSatisfaction),
       AgeGroup = case_when(Age > 17 & Age <= 19 ~ "17-19",
                            Age > 19 & Age <= 30 ~ "20-30",
                            Age > 30 & Age <= 40 ~ "30-40",
                            Age > 40 & Age <= 50 ~ "40-50",
                            Age > 50 & Age <= 60 ~ "50-60", 
                            Age > 60             ~ "> 60")) %>% 
mutate(AgeGroup = factor(AgeGroup, level = c("17-19","20-30", "30-40","40-50","50-60","> 60")))%>% 
mutate(Attrition = factor(Attrition, levels = c("Yes", "No")))

str(empl.att)
```

Let's see the number of deserters

```{r}
table(empl.att$Attrition)
```

```{r}

### Fix the proportion
proportions <- function(feature, target){
  varCat <- as_label(enquo(feature))

  if(missing(target)) {
      prop_data <- empl.att %>%  
      group_by({{feature}}) %>% 
      summarise(n = n(), .groups = "drop") %>% 
      ungroup() %>% 
      mutate(percent = str_c(round(n/sum(n)*100,0),"%"))
    }
  
    else {
      prop_data <- empl.att %>%  
      group_by({{feature}},{{target}}) %>% 
      summarise(n = n(), .groups = "drop") %>% 
      ungroup() %>% 
      mutate(percent = str_c(round(n/sum(n)*100,0),"%"))
  }
}   
```

```{r}
prop_gender <- proportions(Gender)
prop_gender_att <- proportions(Gender, Attrition)
prop_marital_status <- proportions(MaritalStatus)
prop_marital_status_att <- proportions(MaritalStatus, Attrition) 
prop_department <- proportions(Department)
prop_department_att <- proportions(Department, Attrition)
```


## 4. Exploratory Data Analysis

```{r}


empl.att %>% select(starts_with("years"), Attrition) %>% 
ggpairs(
  aes(color = Attrition),
  lower = list(continuous = wrap(
    "smooth",
    alpha = 0.2,
    size = 0.5,
    color = "#DE942E"
  )),
  diag = list(continuous = "barDiag"),
  upper = list(continuous = wrap("cor", size = 4))
) +
  scale_color_manual(values = c("#818625", "#C8512B")) +
  scale_fill_manual(values = c("#818625", "#C8512B")) +
  theme(
    axis.text = element_text(size = 8),
    panel.background = element_rect(fill = "white"),
    strip.background = element_rect(fill = "white"),
    strip.background.x = element_rect(colour = "black"),
    strip.background.y = element_rect(colour = "black"),
    strip.text = element_text(color = "black", face = "bold", size = 8)
  ) +
  labs(
    title = "Pair plot by attrition Var",
    subtitle = "Pair Plot, scatter plot, Histogram and Correlation coefficient",
    caption = "Data Source: Kaggle IBM HR Employee Attrition",
    x = NULL,
    y = NULL
  )
```





## 5. Survival Model


## 6. Conclusion and Recomendations


